# Use official Java 17 (Temurin) LTS base image with Ubuntu Jammy
FROM eclipse-temurin:17-jammy

# Install required CLI tools
RUN apt-get update && \
    apt-get install -y curl zip unzip && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Set WireMock version
ENV WIREMOCK_VERSION=2.33.2

# Download the standalone WireMock JAR
RUN curl -L "https://repo1.maven.org/maven2/com/github/tomakehurst/wiremock-jre8-standalone/${WIREMOCK_VERSION}/wiremock-jre8-standalone-${WIREMOCK_VERSION}.jar" \
    -o /wiremock.jar

# Optional: expose stub folders for mappings & __files
VOLUME ["/home/wiremock/mappings", "/home/wiremock/__files"]

# Expose WireMock's default HTTP port
EXPOSE 8080

# Entrypoint for WireMock
ENTRYPOINT ["java", "-jar", "/wiremock.jar"]
CMD ["--verbose", "--global-response-templating"]


# Replace blocked Ubuntu security/archive URLs with open mirrors
RUN sed -i 's|http://security.ubuntu.com/ubuntu|http://mirror.ubuntu.com/ubuntu|g' /etc/apt/sources.list && \
    sed -i 's|http://archive.ubuntu.com/ubuntu|http://mirror.ubuntu.com/ubuntu|g' /etc/apt/sources.list


# ðŸ›  Patch blocked Ubuntu URLs
RUN sed -i 's|security.ubuntu.com|mirror.ubuntu.com|g' /etc/apt/sources.list && \
    sed -i 's|archive.ubuntu.com|mirror.ubuntu.com|g' /etc/apt/sources.list
